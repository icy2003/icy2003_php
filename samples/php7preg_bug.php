<?php
/**
 * PHP7.0~7.2 正则 bug 示例
 *
 * @see \icy2003\php\iexts\PhpOffice\PhpWord\TemplateProcessor::replaceBlock
 *
 * $string 是从某个 Word 里截取出来的，由于数据敏感，因此做了字符替换，但不影响效果
 * 在 PHP7.0~7.2 版本上结果是空，正确结果应该是能匹配到数据的
 * 将 ini_set 的注释去掉即可解决该 bug
 * 另外：
 * 这个正则应该是没问题的，可以将 $string 开头的第一个 w:p 改成 w:p1
 * 在注释掉 ini_set 居然可以匹配到数据，由于 $string 后面有好几个 w:p，如果是正则错误，那肯定是匹配不到数据的
 * 因此，可以确定是 PHP7.0~7.2 的 bug
 */
$string = '<w:p w:rsidR="008A5ED7" w:rsidRDefault="0032292A" w:rsidP="006724D3"><w:pPr><w:autoSpaceDE w:val="0"/><w:autoSpaceDN w:val="0"/><w:adjustRightInd w:val="0"/><w:ind w:firstLineChars="200" w:firstLine="560"/><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:sz w:val="28"/></w:rPr></w:pPr><w:r w:rsidRPr="004467E5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</w:t></w:r><w:r w:rsidR="00756B1A"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>bbbbbbbbbbbbb</w:t></w:r><w:r w:rsidRPr="004467E5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>，vvvvvvvvvvvvvvvvvvvvvvvvvvvvv</w:t></w:r><w:r w:rsidR="006C0A86" w:rsidRPr="006C0A86"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t xml:space="preserve">GB T18508-2014 </w:t></w:r><w:r w:rsidR="006C0A86" w:rsidRPr="006C0A86"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>ccccccccccccccccccccc</w:t></w:r><w:r w:rsidRPr="004467E5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>，dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd</w:t></w:r><w:r w:rsidRPr="00581900"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>xxx</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>zzzzz</w:t></w:r><w:r w:rsidRPr="00581900"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>hhhhhhhhh</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>sssss</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:lastRenderedPageBreak/><w:t>qqqqqqqqqq</w:t></w:r><w:r w:rsidRPr="00581900"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>，</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>yyyyyyyyyyyy</w:t></w:r><w:r w:rsidRPr="00581900"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>jjjjjjjjjj</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>gnghmyhjfg</w:t></w:r><w:r w:rsidRPr="00581900"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>，</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>kkkkkkkkk</w:t></w:r><w:r w:rsidRPr="003417B0"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>xcsdvsdfasdaSD</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/><w:szCs w:val="28"/></w:rPr><w:t>q1234g4trgsdfsdf</w:t></w:r><w:r w:rsidRPr="004467E5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>asfafsdfdasdasdasdasdasdadqw</w:t></w:r><w:r w:rsidR="006724D3"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>ooooooooooooo</w:t></w:r><w:r w:rsidRPr="004467E5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>rtyutryu</w:t></w:r><w:r w:rsidR="00427598"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>，asdergrjtjyrujthdfsferferf</w:t></w:r><w:r w:rsidR="006724D3"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>dfvsdfvsdfasdasdasdasdasd</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>lllllllllllllllll</w:t></w:r><w:r w:rsidR="008A5ED7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>ZZZZZ</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>dasdasdafgf</w:t></w:r><w:r w:rsidR="008A5ED7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>iiiiiiiiiii</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>，</w:t></w:r><w:r w:rsidR="006724D3"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>v</w:t></w:r><w:r w:rsidRPr="00D7419D"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>sdasdasdasd</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>123123123</w:t></w:r><w:r w:rsidRPr="00D7419D"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>AAAAA</w:t></w:r><w:r w:rsidR="00427598"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>dfgdfg3gf34g</w:t></w:r><w:r w:rsidRPr="00D7419D"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>DDDDD</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>；asdasdwertrhj567hrsdfv</w:t></w:r><w:r w:rsidR="001E10D5"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>g234r23fefge</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>456ujfghertgwerfergferg，</w:t></w:r><w:r w:rsidR="008A5ED7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>tyunyujnfghrythtrfyhty</w:t></w:r></w:p><w:p w:rsidR="00244DB3" w:rsidRPr="006724D3" w:rsidRDefault="008A5ED7" w:rsidP="006724D3"><w:pPr><w:autoSpaceDE w:val="0"/><w:autoSpaceDN w:val="0"/><w:adjustRightInd w:val="0"/><w:ind w:firstLineChars="200" w:firstLine="560"/><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:sz w:val="28"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>dfvdfbfgnmthgertgh</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>dddddddd</w:t></w:r><w:r w:rsidR="00F65AC7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>45645grtghrtrthjrtu</w:t></w:r><w:r w:rsidR="00D06E6C"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>34gefgdfg</w:t></w:r><w:r w:rsidR="0032292A" w:rsidRPr="00D7419D"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:sz w:val="28"/></w:rPr><w:t>。</w:t></w:r></w:p><w:p w:rsidR="00E11977" w:rsidRDefault="00E11977" w:rsidP="008A5ED7"><w:pPr><w:spacing w:line="360" w:lineRule="auto"/><w:ind w:firstLineChars="200" w:firstLine="562"/><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:b/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr></w:pPr><w:r w:rsidRPr="008A5ED7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:b/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>1</w:t></w:r><w:r w:rsidRPr="008A5ED7"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:b/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>2w345grthbtyjghjmghjghj</w:t></w:r><w:r w:rsidR="00F217A0"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:b/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>b</w:t></w:r><w:r w:rsidR="00F217A0"><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:b/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>iao</w:t></w:r></w:p><w:p w:rsidR="006173CF" w:rsidRDefault="006173CF" w:rsidP="006173CF"><w:r><w:rPr><w:rFonts w:hint="eastAsia"/></w:rPr><w:t>${var}</w:t></w:r></w:p><w:p w:rsidR="006173CF" w:rsidRPr="008A5ED7" w:rsidRDefault="006173CF" w:rsidP="006173CF"><w:r><w:t>${/var}</w:t></w:r></w:p><w:p w:rsidR="00E11977" w:rsidRDefault="00E11977" w:rsidP="00E11977"><w:pPr><w:spacing w:line="360" w:lineRule="auto"/><w:ind w:firstLineChars="200" w:firstLine="560"/><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>（</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312"/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>1</w:t></w:r><w:r><w:rPr><w:rFonts w:eastAsia="仿宋_GB2312" w:hint="eastAsia"/><w:color w:val="000000"/><w:sz w:val="28"/></w:rPr><w:t>）5676kyghjtryhjtyjt</w:t></w:r></w:p><w:p w:rsidR="00E11977" w:rsidRDefault="00E11977" w:rsidP="00E11977"><w:pPr><w:spacing w:line="360" w:lineRule="auto"/><w:ind w:firstLineChars="200" w:firstLine="560"/><w:rPr';
// ini_set('pcre.jit', 0);
preg_match('/<w:p ((?!<w:p ).)*?\${var}.*?<\/w:p>.*?<w:p ((?!<w:p ).)*\${\/var}.*?<\/w:p>/is', $string, $matches);

var_dump($matches);
